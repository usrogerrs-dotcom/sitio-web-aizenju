---
import Layout from '../layouts/Layout.astro';
import ServiceCarousel from '../components/ServiceCarousel.astro';

const products = [
  {
    key: 'laptop-recycle',
    title: 'RECICLAJE DE LAPTOPS',
    image: 'https://images.unsplash.com/photo-1472289065668-ce650ac443d2?q=80&w=1600&auto=format&fit=crop',
    issues: [
      'Equipo obsoleto',
      'Pantalla dañada',
      'Batería agotada',
      'Placa/CPU dañados',
      'Donación/partes útiles'
    ],
    eta: '24 - 72 horas (evaluación)',
    helpModelImg: 'https://images.unsplash.com/photo-1498049794561-7780e7231661?q=80&w=1200&auto=format&fit=crop',
    helpSerieImg: 'https://images.unsplash.com/photo-1498050108023-c5249f4df085?q=80&w=1200&auto=format&fit=crop',
    helpModelText: 'Para reciclaje, indícanos el modelo si está visible en etiqueta trasera o factura.',
    helpSerieText: 'El número de serie ayuda a la trazabilidad del proceso. Si no está disponible, indícalo.'
  }
];
---
<Layout>
  <!-- Hero claro con animación sutil y fondo animado -->
  <section class="r-hero" aria-label="Reciclaje de laptops">
    <video class="r-hero__video" autoplay loop muted playsinline aria-hidden="true">
      <source src="/video/loop-componentes.mp4" type="video/mp4" />
    </video>
    <div class="r-hero__content">
      <h1 class="r-hero__title">Dale una segunda vida a tu tecnología.</h1>
    </div>
  </section>

  <!-- Propósito -->
  <section class="r-purpose">
    <div class="wrap">
      <h2>Tu laptop vieja es un tesoro, no basura.</h2>
      <p>
        La chatarra electrónica crece cada año. Recuperar componentes y reacondicionar equipos
        reduce residuos y abre oportunidades para más estudiantes.
      </p>
    </div>
  </section>

  <!-- Proceso en 3 pasos -->
  <section class="r-process" aria-label="Nuestro Proceso en 3 Pasos">
    <div class="wrap">
      <h3>Nuestro Proceso en 3 Pasos</h3>
      <div class="grid">
        <article class="card">
          <h4>Donar mi laptop</h4>
          <p>Pulsa en “reciclar mi laptop”, selecciona las características del equipo.</p>
        </article>
        <article class="card accent">
          <h4>Mi Recompensa</h4>
          <p>Recicla y elige un producto que sí necesites usar.</p>
        </article>
        <article class="card">
          <h4>Llevar / Recibir</h4>
          <p>Deposítala en un punto Aizenju o solicita envío a domicilio.</p>
        </article>
      </div>
    </div>
  </section>

  <!-- Carrusel práctico de selección -->
  <ServiceCarousel products={products} />

  <!-- Impacto con contadores -->
  <section class="r-impact" aria-label="El Ciclo Aizenju">
    <div class="wrap">
      <h3>El Ciclo Aizenju</h3>
      <div class="impact-grid">
        <div class="impact">
          <strong data-counter="3200">0</strong>
          <span>Kilos de e-waste evitados</span>
        </div>
        <div class="impact">
          <strong data-counter="860">0</strong>
          <span>Componentes recuperados</span>
        </div>
        <div class="impact">
          <strong data-counter="420">0</strong>
          <span>Estudiantes beneficiados</span>
        </div>
      </div>
    </div>
  </section>

  <!-- CTA final -->
  <section class="r-cta">
    <h3>Únete al movimiento.</h3>
    <a class="btn" href="/reciclar">Reciclar mi laptop</a>
  </section>
</Layout>

<script>
  // Cargar métricas reales desde /data/impacto.json y animar contadores
  async function initCounters() {
    try {
      const res = await fetch('/data/impacto.json', { cache: 'no-cache' });
      const data = await res.json();
      const map = new Map([
        ['ewaste', Number(data.ewaste || 0)],
        ['componentes', Number(data.componentes || 0)],
        ['estudiantes', Number(data.estudiantes || 0)],
      ]);
      document.querySelector('[data-counter="3200"]')?.setAttribute('data-counter', String(map.get('ewaste') || 0));
      document.querySelector('[data-counter="860"]')?.setAttribute('data-counter', String(map.get('componentes') || 0));
      document.querySelector('[data-counter="420"]')?.setAttribute('data-counter', String(map.get('estudiantes') || 0));
    } catch {}
    const counters = document.querySelectorAll('[data-counter]');
    const obs = new IntersectionObserver((entries) => {
      for (const e of entries) {
        if (e.isIntersecting) {
          const el = e.target;
          const target = Number(el.getAttribute('data-counter') || '0');
          const duration = 1200;
          const start = performance.now();
          const from = 0;
          function step(now: number) {
            const t = Math.min(1, (now - start)/duration);
            const val = Math.floor(from + (target - from) * (t*t*(3-2*t))); // ease in-out
            el.textContent = val.toString();
            if (t < 1) requestAnimationFrame(step);
          }
          requestAnimationFrame(step);
          obs.unobserve(el);
        }
      }
    }, { threshold: 0.4 });
    counters.forEach(c => obs.observe(c));
  }
  initCounters();
</script>

<style>
  .wrap { max-width: 900px; margin: 0 auto; padding: 0 20px; }

  /* Hero claro */
  .r-hero { position: relative; background: #f6f7f9; color: #0a0a0a; min-height: 92vh; display: grid; place-items: center; overflow: hidden; }
  .r-hero__content { text-align: center; padding: 120px 20px 80px; }
  .r-hero__title { font-size: clamp(2.2rem, 8vw, 5rem); font-weight: 900; letter-spacing: -0.02em; margin: 0; opacity: 0; transform: translateY(16px); animation: fadeInUp .8s ease forwards .2s; }
  .r-hero__video { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; filter: saturate(0.9) brightness(0.95); }

  @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }

  /* Propósito */
  .r-purpose { background: #0a0a0a; color: #e5e7eb; padding: 60px 0; text-align: center; }
  .r-purpose h2 { font-size: clamp(1.6rem, 4vw, 2.6rem); margin: 0 0 10px; }
  .r-purpose p { color: #9ca3af; margin: 0 auto; max-width: 780px; }

  /* Proceso */
  .r-process { padding: 60px 0; background: #0b0c0e; }
  .r-process h3 { text-align: center; margin: 0 0 20px; font-size: 1.6rem; }
  .r-process .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 18px; }
  .r-process .card { background: #0f1115; border: 1px solid rgba(255,255,255,0.06); border-radius: 16px; padding: 20px; transition: transform .2s ease, border-color .2s ease, box-shadow .2s ease; text-align: center; }
  .r-process .card:hover { transform: translateY(-4px); border-color: rgba(255,255,255,0.16); box-shadow: 0 10px 30px rgba(0,0,0,0.25); }
  .r-process .card h4 { margin: 0 0 8px; }
  .r-process .card p { margin: 0; color: #9ca3af; }
  .r-process .card.accent { background: linear-gradient(180deg, rgba(124,58,237,0.15), rgba(6,182,212,0.15)); }

  /* Impacto */
  .r-impact { background: #0a0a0a; padding: 60px 0; }
  .r-impact h3 { text-align: center; margin: 0 0 20px; font-size: 1.6rem; }
  .impact-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 18px; }
  .impact { background: #0f1115; border: 1px solid rgba(255,255,255,0.06); border-radius: 16px; padding: 20px; text-align: center; }
  .impact strong { display: block; font-size: clamp(2rem, 6vw, 3.2rem); color: #e5e7eb; }
  .impact span { color: #9ca3af; }

  /* CTA */
  .r-cta { text-align: center; padding: 70px 20px 120px; background: #0b0c0e; }
  .r-cta h3 { font-size: clamp(1.8rem, 5vw, 2.6rem); margin: 0 0 12px; }
  .btn { display: inline-block; padding: 12px 18px; background: #7c3aed; color: #fff; text-decoration: none; border-radius: 10px; box-shadow: 0 8px 24px rgba(124,58,237,0.35); }

  @media (max-width: 900px) {
    .r-process .grid, .impact-grid { grid-template-columns: 1fr; }
  }
</style>
